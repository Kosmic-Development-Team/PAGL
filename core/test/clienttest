from networking import connection
import time

def cme(nm):
    bts = bytearray()
    name = nm[0]
    bts.append(len(name))
    bts.extend(map(ord, name))
    bts.extend(map(ord, nm[1]))
    return bts


def cmd(data):
    ns = data[0]
    nm = data[1:].decode('ascii')
    return nm[0:ns], nm[ns:]


connection.registertype(0b00000000, lambda d: cme(d), lambda d: cmd(d))
connection.registertype(0b00000001, lambda n: bytearray(n), lambda d: d.decode('ascii'))
connection.registertype(0b00000010, lambda d: d, lambda d: d)
servname = ''


def rsn(c, sname):
    global servname
    servname = sname
    c.sendmessage(0b00000001, name)
    print(servname)

name = input('What is your name: ')
addr = input('What is the Chat server IP: ')
connection.mainport = 25565
you = connection.connect(addr)
you.registerhandler(0b00000001, lambda d: rsn(you, d))
open = you.open()
open.start()
time.sleep(5)
print('sent')
you.sendmessage(0b00000010, b'')

